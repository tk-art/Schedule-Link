{% extends "base.html" %}
{% block title %}プロフィール{% endblock %}
{% block content %}

<div class="container col-md-6">
  <div class="profile-container">
    <div class="profile-info">
      {% if profile.image %}
        <img src="{{ profile.image.url }}" alt="{{ profile.username }}" class="profile-image-size">
      {% else %}
        <div class="default-image"></div>
      {% endif %}

      <p class="profile-username">{{ profile.username }}</p>

      {% if request.user == profile.user %}
        <a href="/profile_edit" class="profile-edit">プロフィール編集</a>
      {% endif %}

      {% if request.user != profile.user %}
        <a class="follow" id="follow-button" data-following="{{ is_following }}" onclick="followButtonClicked()">フォロー</a>
      {% endif %}
    </div>

    <div class="profile-top">
      <div class="follow-count">
        <a class="profile-follow" data-bs-toggle="modal" data-bs-target="#followmodal">フォロー中：{{ follows.count }}</a>
        <a class="profile-follower" data-bs-toggle="modal" data-bs-target="#followermodal">フォロワー：{{ followers.count }}</a>
      </div>

      <p>地域：{{ profile.residence }}</p>
      <p>年齢：{{ profile.age }}</p>
      <p>性別：{{ profile.gender }}</p>
      <p class="profile-content">メッセージ：{{ profile.content }}</p>
    </div>

    <div class="hobby-interest">
      <p>趣味</p>
      <ul>
        {% for hobby in hobbies %}
          <li class="hobby-list">{{ hobby.name }}</li>
        {% endfor %}
      </ul>
      <p>興味</p>
      <ul>
        {% for interest in interests %}
          <li class="interest-list">{{ interest.name }}</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="separator"></div>

  <div class="calendar-container">
    <div id="calendar"></div>
  </div>

  <!--フォローモーダル-->
  <div class="modal fade folow-modal" id="followmodal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <p class="modal-title">フォロー中</p>
        </div>
        <div class="modal-body">
          <div class="follow-modal-content">
            {% for follow in follows %}
              <a href="/profile/{{ follow.user.id }}" class="follow-link">
                <img src="{{ follow.image.url }}" alt="{{ follow.username }}" class="follow-image-size">
                {{ follow.username }}
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--フォロワーモーダル-->
  <div class="modal fade folow-modal" id="followermodal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <p class="modal-title">フォロワー</p>
        </div>
        <div class="modal-body">
          <div class="follow-modal-content">
            {% for follower in followers %}
              <a href="/profile/{{ follower.user.id }}" class="follower-link">
                <img src="{{ follower.image.url }}" alt="{{ follower.username }}" class="follow-image-size">
                {{ follower.username }}
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--カレンダーモーダル-->
  <div class="modal fade" id="eventModal" tabindex="-1" role="dialog" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="eventModalLabel">暇な時間を入力してください</h5>
          <form action="/delete_calendar/" method="post">
            {% csrf_token %}
            <input type="hidden" name="user_id" value="{{ profile.user.id }}">
            <input type="hidden" id="deleteDate" name="deleteDate" value="">
            <button type ="submit" class="btn btn-danger" id="deleteEvent">削除</button>
          </form>
        </div>
        <div class="modal-body">
          <form action="/calendar/" method="post">
            {% csrf_token %}
            <input type="hidden" id="selectedDate" name="selectedDate" value="">
            <div class="form-group">
              <label for="free" class="calendar-label">予定</label>
              <select class="form-control free" id="eventTitle" name="free">
                  <option value="">選択してください</option>
                  <option>全日</option>
                  <option>部分</option>
              </select>
            </div>

            <div class="form-group" id="timeSelectGroup" style="display: none;">
              <label for="time" class="calendar-label">時間</label>
              <input type="text" class="form-control" id="time" name="time" placeholder="13:00~15:00, 14:00以降など" value="">
            </div>

            <div class="form-group" id="messageSelectGroup">
              <label for="message" class="calendar-label">メッセージ</label>
              <input type="text" class="form-control" id="message" name="message" placeholder="任意です" value="">
            </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary" id="saveEvent">保存</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!--他ユーザーカレンダーモーダル-->
  <div class="modal fade" id="otherUserModal" tabindex="-1" role="dialog" aria-labelledby="otherUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm" role="document">
      <div class="modal-content other-modal">
        <div class="modal-header">
            <div id="selectedData" class="modal-selected"></div>
        </div>

        <div class="modal-body">
          <span>予定：</span><p id="otherUserData" class="otheruser-data"></p>
          <span>時間：</span><p id="timeData" class="otheruser-data"></p>
          <span>メッセージ：</span><p id="messageData" class="otheruser-data"></p>
        </div>

      </div>
    </div>
  </div>

</div>

<script>
  var userId = '{{ profile.user.id }}';
  var csrfToken = '{{ csrf_token }}';
  var currentUser = '{{ current_user|yesno:"true,false"  }}';
</script>
{% endblock %}